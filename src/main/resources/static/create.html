<div class="wrapper">

        <div class="modal fade text-center" id="create-fail-modal" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Failure</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#create-fail-modal').modal('hide');">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="$('#create-fail-modal').modal('hide');">Close</button>
                    </div>        
                </div>
            </div>
        </div>
    
        <div class="modal fade text-center" id="create-success-modal" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Success</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="$('#success-modal').modal('hide');">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" id="error-message">
                        <p>Painting creation was successful.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="$('#success-modal').modal('hide');">Close</button>
                    </div>        
                </div>
            </div>
        </div>

        <div id="formContent">
        <!-- Tabs Titles -->
                        
        <!-- Icon -->
        <div>
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR0EHw9OytxKmTIIyrIlqyATKasoXIK87QFHJcFxJcpRmzA7kTE&s" id="icon" alt="Create Icon" />
        </div>
                       
        <!-- Login Form -->
        <form id="create-form">
            <input type="hidden" id="id" name="id" value="">
            <input type="hidden" id="url" name="url" value="">


            <label for="label">The person who created the painting</label><br/>
            <input type="text" id="label" name="label" placeholder="Label">

            <label for="creator">The person who created the painting</label><br/>
            <input type="text" id="creator" name="creator" placeholder="Creator (Q*******)">
        
            <label for="ctime">The time of creation</label><br/>
            <input type="date" name="ctime" id="ctime"><br/>

            <label for="invnum">An identifier of the physical object</label><br/>
            <input type="text" id="invnum" name="invnum" placeholder="Inventory number">

            <label for="materials">Materials used for the painting</label><br/>
            <!-- class="selectpicker" multiple title="Choose from these..." data-style="btn-primary" -->
            <select id="materials" name="materials" multiple>
                <option value="Q16354">whiteboard</option>
                <option value="Q1066536">rice paper</option>
                <option value="Q1287518">Shaped canvas</option>
                <option value="Q25631150">fresco</option>
                <option value="Q175166">tempera</option>
                <option value="Q189085">pastel</option>
                <option value="Q204330">gouache paint</option>
                <option value="Q207849">acrylic paint</option>
                <option value="Q296955">oil paint</option>
                <option value="Q297081">oil pastel</option>
                <option value="Q787010">automotive paint</option>
                <option value="Q818405">linseed oil</option>
                <option value="Q927860">cephalopod ink</option>
                <option value="Q1421953">fixative</option>
                <option value="Q1456571">alkyd</option>
                <option value="Q3002365">Crayon Aquarell</option>
                <option value="Q3110378">drawing gum</option>
                <option value="Q3217799">nitrocellulose paint</option>
                <option value="Q3389292">spray gun</option>
                <option value="Q3541776">colour tube</option>
                <option value="Q7234160">Poster paint</option>
                <option value="Q11813560">stencil</option>
                <option value="Q12981547">India ink</option>
                <option value="Q22915256">watercolor paint</option>
            </select>

            <label for="location">Location of the painting </label><br/>
            <input type="text" id="location" name="location" placeholder="Location (Q*******)">

            <label for="description">Short description of the painting </label><br/>
            <textarea rows="4" cols="40" name="description" id="description" form="create-form"></textarea>

            <input type="submit" value="Submit">
        </form>

        <!-- Remind Passowrd -->
        <div id="formFooter">
            <input type="button" value="Close" onclick="$('#thinmodal-create').modal('hide');">
        </div>
        <script>
            $('#thinmodal-create').on('shown.bs.modal', function(){
                $('#create-form').submit(function(e){
                    e.preventDefault();

                    var xhr = new XMLHttpRequest();
                    var url = '/login';
            
                    xhr.onreadystatechange = function(){
                        if(xhr.readyState === 4){
                            if(xhr.status === 200){

                                var xhr2 = new XMLHttpRequest();
                                var url2 = '/create';

                                xhr2.onreadystatechange = function(){
                                    if(xhr2.readyState === 4){
                                        console.log(xhr.responseText);

                                        console.log("response arrived");
                                        if(xhr2.status === 200){
                                            $('#create-success-modal').modal('show');
                                        } else {
                                            $('#error-message p').remove();
                                            JSON.parse(xhr.responseText).array.forEach(element => {
                                                $('#error-message').add("<p>" + element + "</p>");
                                            });
                                            $('#create-fail-modal').modal('show');
                                        }


                                    }
                                }
                            
                                var payload = JSON.stringify(
                                    { 
                                        id: $('#id').val(),
                                        url: $('#url').val(),
                                        label: $('#label').val(),
                                        description: $('#description').val(),
                                        creator: $('#creator').val(),
                                        ctime: $('#ctime').val(),
                                        invnum: $('#invnum').val(),
                                        materials: $('#materials').val(),
                                        location: $('#location').val()
                                    }
                                );
                                console.log(payload)
                                xhr2.open("POST", url2);
                                xhr2.setRequestHeader("Content-Type", "application/json");
                                xhr2.send(payload);



                            } else if(xhr.status === 403){
                                $('#error-message p').remove();
                                $('#error-message').add("<p>Login required for painting creation</p>");
                                $('#create-fail-modal').modal('show');
                            }
                        }
                    }
            
                    xhr.open("GET", url);
                    xhr.send();

                });
            });
        </script>
    </div>
